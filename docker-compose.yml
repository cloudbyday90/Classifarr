version: '3.8'

services:
  classifarr:
    build:
      context: .
      dockerfile: Dockerfile
    image: ghcr.io/cloudbyday90/classifarr:latest
    container_name: classifarr
    ports:
      - "21324:21324"
    environment:
      # User/Group IDs - Set to match your host user for proper file permissions
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - UMASK=${UMASK:-022}
      # Application settings
      - NODE_ENV=production
      - TZ=${TZ:-UTC}
    volumes:
      - ./data:/app/data
      # ═══════════════════════════════════════════════════════════════
      # MEDIA ACCESS (Required for Re-Classification feature)
      # ═══════════════════════════════════════════════════════════════
      # Map your media folders so Classifarr can verify file moves.
      # Use read-only (:ro) if you don't want Classifarr to modify files.
      #
      # Format: /host/path:/container/path:ro
      #
      # Example for single media folder:
      # - /mnt/user/media:/data/media:ro
      #
      # Example for separate movie/tv folders:
      # - /mnt/user/movies:/data/movies:ro
      # - /mnt/user/tv:/data/tv:ro
      # ═══════════════════════════════════════════════════════════════
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:21324/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
